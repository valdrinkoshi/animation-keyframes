<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>animation-keyframes demo</title>

  <script src="../webcomponentsjs/webcomponents-loader.js"></script>

  <link rel="import" href="../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../iron-demo-helpers/demo-snippet.html">
  <link rel="import" href="../paper-input/paper-input.html">
  <link rel="import" href="../paper-button/paper-button.html">
  <link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
  <link rel="import" href="../paper-listbox/paper-listbox.html">
  <link rel="import" href="../paper-item/paper-item.html">
  <link rel="import" href="../animation-keyframes/animation-keyframes.html">
  <link rel="import" href="../animation-keyframes/bezier-easing.html">

  <custom-style>
    <style is="custom-style" include="demo-pages-shared-styles">
      demo-snippet {
        --demo-snippet-demo: {
          height: 0;
          padding: 0;
        }
        --demo-snippet-code: {
          max-height: 300px;
          padding: 0;
          padding-left: 5px;
        }
      }

      #wrapper {
        margin-top: 1rem;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        background-color: #f5f5f5;
      }

      #content {
        padding: 10px;
      }

      .start-invisible:not([visible]) {
        display: none;
      }

      #play {
        width: 100%;
        margin: 10px 0;
      }

      #wrapper,
      #content {
        transform-origin: top left;
        animation-delay: 400ms;
        animation-fill-mode: both;
      }

      #play:not([disabled])+#wrapper,
      #play:not([disabled])+#wrapper #content {
        animation-name: none !important;
      }

      .inputs {
        @apply --layout-horizontal;
        @apply --layout-justified;
        @apply --layout-wrap;
      }
    </style>
  </custom-style>
</head>

<body class="centered">
  <dom-bind>
    <template>
      <h2>&lt;animation-keyframes&gt; demo</h2>
      <p>&lt;animation-keyframes&gt; generates keyframes for performant expand/collapse animations. See more deails on this
        technique
        <a href="https://developers.google.com/web/updates/2017/03/performant-expand-and-collapse">here</a>.</p>

      <div class="inputs">
        <paper-input name="animationName" required label="Animation name" value="[[animationName]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[a-zA-Z]" minlength="1"></paper-input>
        <paper-input name="duration" type="number" required label="Duration (ms)" value="[[duration]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9]" max="10000" min="2"></paper-input>
        <paper-input name="fps" type="number" required label="FPS" value="[[fps]]" on-value-changed="validateAndUpdateValue" allowed-pattern="[0-9]"
          max="150" min="2"></paper-input>
        <paper-dropdown-menu label="Ease function" selected-item-label="{{easeType}}" no-animations>
          <paper-listbox slot="dropdown-content" selected="0">
            <paper-item>default</paper-item>
            <paper-item>linear</paper-item>
            <paper-item>ease</paper-item>
            <paper-item>ease-in</paper-item>
            <paper-item>ease-out</paper-item>
            <paper-item>ease-in-out</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="preset" selected-item-label="{{preset}}" on-selected-item-label-changed="updatePresetInfo" no-animations>
          <paper-listbox slot="dropdown-content" selected="0">
            <paper-item>vertical-expand</paper-item>
            <paper-item>vertical-collapse</paper-item>
            <paper-item>horizontal-expand</paper-item>
            <paper-item>horizontal-collapse</paper-item>
            <paper-item>expand</paper-item>
            <paper-item>collapse</paper-item>
            <paper-item>custom</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>
      <div class="inputs start-invisible" visible$="[[isCustomPreset]]">
        <paper-input name="fromScaleX" type="number" required label="From scale x" value="[[fromScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="toScaleX" type="number" required label="To scale x" value="[[toScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="fromScaleY" type="number" required label="From scale y" value="[[fromScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="toScaleY" type="number" required label="To scale x" value="[[toScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
      </div>

      <animation-keyframes animation-name="[[animationName]]" duration="[[duration]]" preset="[[preset]]" fps="[[fps]]" from-scale-x="[[fromScaleX]]"
        to-scale-x="[[toScaleX]]" from-scale-y="[[fromScaleY]]" to-scale-y="[[toScaleY]]" ease-callback="[[computeEaseCallback(easeType)]]"
        on-style-text-content-changed="updateMarkdown"></animation-keyframes>

      <paper-button id="play" raised on-tap="play">Play animation</paper-button>
      <div id="wrapper" class$="[[animationName]]" on-animationend="stop">
        <div id="content" contenteditable class$="[[computeInversedName(animationName)]]">
          <h3>Performant [[preset]] animation!</h3>
          <p>This content is editable! Try modifying it while the animation is playing!</p>
          <ul>
            <li>item 1</li>
            <li>item 2</li>
            <li>item 3</li>
          </ul>
        </div>
      </div>

      <h3>&lt;animation-keyframes&gt; generates this stylesheet for you.</h3>

      <p>
        Apply <b>[[animationName]]</b> class to the wrapper element, and <b>[[animationName]]Inverse</b> class to the content.
      </p>

      <i>Consider copying it and saving this as a static resource.</i>
      <p>
        <code>[[animationName]].css: <span id="count"></span></code>
      </p>

      <demo-snippet id="snippet"></demo-snippet>

    </template>
  </dom-bind>
  <script>
    const domBind = document.querySelector('dom-bind');
    const onNextRAF = callback => {
      callback.__raf && cancelAnimationFrame(callback.__raf);
      callback.__raf = requestAnimationFrame(() => {
        callback.__raf = null;
        callback();
      })
    };
    addEventListener('WebComponentsReady', () => {
      const keyframes = document.querySelector('animation-keyframes');
      const playButton = document.querySelector('#play');

      domBind.computeInversedName = animationName => animationName + 'Inverse';
      domBind.computeEaseCallback = type => domBind.easeCallbacks[type];
      domBind.play = () => onNextRAF(() => playButton.disabled = true);
      domBind.stop = () => setTimeout(() => playButton.disabled = false, 200);

      domBind.updatePresetInfo = (event) => {
        domBind.isCustomPreset = event.target.selectedItemLabel === 'custom';
        if (domBind.isCustomPreset) {
          domBind.fromScaleX = keyframes.fromScaleX;
          domBind.fromScaleY = keyframes.fromScaleY;
          domBind.toScaleX = keyframes.toScaleX;
          domBind.toScaleY = keyframes.toScaleY;
        }
      };

      domBind.updateMarkdown = (event) => {
        const styleTextContent = event.target.styleTextContent || '';
        snippet._markdown = styleTextContent ? '```css\n' + styleTextContent + '```' : '';
        count.textContent =
          `${event.target.framesCount} keyframes, ${styleTextContent.split(/\n/).length - 1} lines, ${styleTextContent.length} chars.`;
      };

      domBind.validateAndUpdateValue = (event) => {
        const input = event.target;
        if (input.validate())
          onNextRAF(() => domBind[input.name] = (input.type === 'number' ? Number(input.value) : input.value));
      };

      domBind.setProperties({
        animationName: 'myAnimation',
        duration: 200,
        fps: 60,
        easeCallbacks: {
          'default': keyframes.easeCallback,
          'linear': null,
          'ease': BezierEasing(.25, .1, .25, 1),
          'ease-in': BezierEasing(.42, 0, 1, 1),
          'ease-out': BezierEasing(0, 0, .58, 1),
          'ease-in-out': BezierEasing(.42, 0, .58, 1)
        }
      });
    });
  </script>
</body>

</html>