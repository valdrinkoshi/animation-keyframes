<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>animation-keyframes</title>

  <script charset="utf-8">
    /**
     * Adapter to use BezierEasing installed via bower.
     */
    (global => {
      if (!global.module) {
        global.module = {};
        Object.defineProperty(global.module, 'exports', {
          set: (mod) => global.BezierEasing = mod
        });
      }
    })(this);
  </script>
  <script src="../bezier-easing/src/index.js"></script>

  <script src="../webcomponentsjs/webcomponents-loader.js"></script>

  <link rel="import" href="../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../iron-demo-helpers/demo-snippet.html">
  <link rel="import" href="../paper-input/paper-input.html">
  <link rel="import" href="../paper-input/paper-textarea.html">
  <link rel="import" href="../paper-button/paper-button.html">
  <link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
  <link rel="import" href="../paper-listbox/paper-listbox.html">
  <link rel="import" href="../paper-item/paper-item.html">
  <link rel="import" href="../animation-keyframes/animation-keyframes.html">

  <custom-style>
    <style is="custom-style" include="demo-pages-shared-styles">
      demo-snippet {
        --demo-snippet-demo: {
          height: 0;
          padding: 0;
        }
        --demo-snippet-code: {
          max-height: 300px;
          padding: 0;
          padding-left: 5px;
        }
      }

      #wrapper {
        margin-top: 1rem;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        background-color: #f5f5f5;
      }

      #content {
        padding: 10px;
      }

      .start-invisible:not([visible]) {
        display: none;
      }

      #play {
        width: 100%;
        margin: 10px 0;
      }

      #play:not([disabled])+#wrapper,
      #play:not([disabled])+#wrapper #content {
        animation-name: none !important;
      }

      .inputs {
        @apply --layout-horizontal;
        @apply --layout-justified;
        @apply --layout-wrap;
      }

      .inputs>* {
        min-width: 100px;
      }
    </style>
  </custom-style>
</head>

<body class="centered">
  <dom-bind>
    <template>
      <h1>animation-keyframes</h1>
      <p>
        <a href="https://github.com/valdrinkoshi/animation-keyframes/">&lt;animation-keyframes&gt;</a> generates keyframes
        for performant expand/collapse animations. The technique consists in using scale transforms when animating clips, and prevent the skewing of the content by counter-scaling it.
        <a href="https://developers.google.com/web/updates/2017/03/performant-expand-and-collapse">See more details here</a>.
      </p>

      <h2>Usage examples</h2>
      <ul>
        <li><a href="../animation-keyframes/examples/dropdown-menu/">&lt;dropdown-menu&gt;</a> to overlap content on top of the trigger</li>
        <li><a href="../animation-keyframes/examples/expand-collapse/">&lt;expand-collapse&gt;</a> to reveal content around the trigger</li>
        <li>This page to generate animation keyframes</li>
      </ul>

      <h1>Animation keyframes generator</h1>
      <div class="inputs">
        <paper-input name="animationName" required always-float-label label="Animation name" value="[[animationName]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[a-zA-Z]" minlength="1"></paper-input>
        <paper-input name="duration" type="number" required always-float-label label="Duration (ms)" value="[[duration]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9]" max="10000" min="2"></paper-input>
        <paper-input name="fps" type="number" required always-float-label label="FPS" value="[[fps]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9]" max="150" min="2"></paper-input>
        <paper-dropdown-menu label="Ease function" always-float-label no-animations>
          <paper-listbox slot="dropdown-content" selected="[[easeCallbackIndex]]" on-selected-changed="updateEaseCallback">
            <template is="dom-repeat" items="[[easeCallbacks]]">
              <paper-item>[[item.displayValue]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="preset" always-float-label no-animations>
          <paper-listbox slot="dropdown-content" selected="[[presetIndex]]" on-selected-changed="updatePreset">
            <template is="dom-repeat" items="[[presets]]">
              <paper-item>[[item.displayValue]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>
      <div class="inputs start-invisible" visible$="[[isCustomPreset]]">
        <paper-input name="fromScaleX" type="number" required always-float-label label="From scale x" value="[[fromScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="10" min="0" step="0.05"></paper-input>
        <paper-input name="toScaleX" type="number" required always-float-label label="To scale x" value="[[toScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="10" min="0" step="0.05"></paper-input>
        <paper-input name="fromScaleY" type="number" required always-float-label label="From scale y" value="[[fromScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="10" min="0" step="0.05"></paper-input>
        <paper-input name="toScaleY" type="number" required always-float-label label="To scale x" value="[[toScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="10" min="0" step="0.05"></paper-input>
      </div>

      <paper-textarea name="customizedStyles" always-float-label label="Custom styles" value="{{customizedStyles}}" on-value-changed="updateHash"></paper-textarea>
      <style>
        .[[animationName]],
        .[[computeInversedName(animationName)]] {
          [[customizedStyles]]
        }
      </style>

      <animation-keyframes id="keyframes" animation-name="[[animationName]]" duration="[[duration]]" preset="[[preset]]" fps="[[fps]]"
        from-scale-x="[[fromScaleX]]" to-scale-x="[[toScaleX]]" from-scale-y="[[fromScaleY]]" to-scale-y="[[toScaleY]]" ease-callback="[[easeCallback]]"
        on-style-text-content-changed="updateMarkdown"></animation-keyframes>

      <paper-button id="play" raised on-tap="play">Play animation</paper-button>
      <div id="wrapper" class$="[[animationName]]" on-animationend="stop">
        <div id="content" contenteditable class$="[[computeInversedName(animationName)]]">
          <h3>Performant [[preset]] animation!</h3>
          <p>This content is editable! Try modifying it while the animation is playing!</p>
          <ul>
            <li>item 1</li>
            <li>item 2</li>
            <li>item 3</li>
          </ul>
        </div>
      </div>

      <h2>Generated stylesheet</h2>

      <p>
        Apply <b>[[animationName]]</b> class to the wrapper element, and <b>[[animationName]]Inverse</b> class to the content.
      </p>

      <i>Consider copying it and saving this as a static resource.</i>
      <p>
        <code>[[animationName]].css: <span id="count"></span></code>
      </p>

      <demo-snippet id="snippet"></demo-snippet>

    </template>
  </dom-bind>
  <script>
    const domBind = document.querySelector('dom-bind');
    const onNextRAF = callback => {
      callback.__raf && cancelAnimationFrame(callback.__raf);
      callback.__raf = requestAnimationFrame(() => {
        callback.__raf = null;
        callback();
      })
    };

    const updateHash = () => {
      let hash = [
        `animationName=${domBind.animationName}`,
        `duration=${domBind.duration}`,
        `fps=${domBind.fps}`,
        `presetIndex=${domBind.presetIndex}`,
        `easeCallbackIndex=${domBind.easeCallbackIndex}`,
      ];
      if (domBind.isCustomPreset) {
        hash = hash.concat([
          `fromScaleX=${domBind.fromScaleX}`,
          `fromScaleY=${domBind.fromScaleY}`,
          `toScaleX=${domBind.toScaleX}`,
          `toScaleY=${domBind.toScaleY}`,
        ]);
      }
      if (domBind.customizedStyles) {
        hash.push(`customizedStyles=${domBind.customizedStyles}`);
      }
      location.hash = hash.join('&');
    };

    domBind.updateMarkdown = (event) => {
      const styleTextContent = keyframes.styleTextContent || '';
      snippet._markdown = styleTextContent ? '```css\n' + styleTextContent + '```' : '';
      count.textContent =
        `${keyframes.framesCount} keyframes, ${styleTextContent.split(/\n/).length - 1} lines, ${styleTextContent.length} chars.`;
      domBind.updateHash();
    };
    domBind.updateHash = function() {
      onNextRAF(updateHash);
    };
    domBind.updatePreset = (event) => {
      domBind.presetIndex = event.detail.value;
      domBind.preset = domBind.presets[domBind.presetIndex].value;
      domBind.isCustomPreset = domBind.preset === null;
      if (domBind.isCustomPreset) {
        domBind.fromScaleX = keyframes.fromScaleX;
        domBind.fromScaleY = keyframes.fromScaleY;
        domBind.toScaleX = keyframes.toScaleX;
        domBind.toScaleY = keyframes.toScaleY;
      }
      domBind.updateHash();
    };
    domBind.updateEaseCallback = (event) => {
      domBind.easeCallbackIndex = event.detail.value;
      domBind.easeCallback = domBind.easeCallbacks[domBind.easeCallbackIndex].value;
    };

    domBind.computeInversedName = animationName => animationName + 'Inverse';
    domBind.play = () => onNextRAF(() => play.disabled = true);
    domBind.stop = () => setTimeout(() => play.disabled = false, 200);
    domBind.validateAndUpdateValue = (event) => {
      const input = event.target;
      if (input.validate())
        onNextRAF(() => domBind[input.name] = (input.type === 'number' ? Number(input.value) : input.value));
    };
    addEventListener('WebComponentsReady', () => {
      const props = {
        animationName: 'myAnimation',
        duration: 200,
        fps: 60,
        presetIndex: 0,
        easeCallbackIndex: 0,
        fromScaleX: 1,
        fromScaleY: 1,
        toScaleX: 1,
        toScaleY: 0,
        customizedStyles: `transform-origin: left top;
animation-delay: 400ms;
animation-fill-mode: both;`,
      };
      // Read values from url.
      location.hash.replace(/^#/g, '').split('&').forEach(param => {
        const params = param.split('=');
        if (params.length === 2) {
          const property = decodeURI(params[0]);
          const value = decodeURI(params[1]);
          if (property in props && value) {
            props[property] = typeof props[property] === 'number' ? Number(value) : value;
          }
        }
      });
      Object.assign(props, {
        presets: [{
          displayValue: 'vertical expand',
          value: 'vertical-expand'
        }, {
          displayValue: 'vertical collapse',
          value: 'vertical-collapse'
        }, {
          displayValue: 'horizontal expand',
          value: 'horizontal-expand'
        }, {
          displayValue: 'horizontal collapse',
          value: 'horizontal-collapse'
        }, {
          displayValue: 'expand',
          value: 'expand'
        }, {
          displayValue: 'collapse',
          value: 'collapse'
        }, {
          displayValue: 'custom',
          value: null
        }],
        easeCallbacks: [{
          displayValue: 'default',
          value: keyframes.easeCallback
        }, {
          displayValue: 'linear',
          value: null
        }, {
          displayValue: 'ease',
          value: BezierEasing(.25, .1, .25, 1)
        }, {
          displayValue: 'ease-in',
          value: BezierEasing(.42, 0, 1, 1)
        }, {
          displayValue: 'ease-out',
          value: BezierEasing(0, 0, .58, 1)
        }, {
          displayValue: 'ease-in-out',
          value: BezierEasing(.42, 0, .58, 1)
        }]
      });
      props.preset = props.presets[props.presetIndex].value;
      props.isCustomPreset = props.preset === null;
      props.easeCallback = props.easeCallbacks[props.easeCallbackIndex].value;

      domBind.setProperties(props);
    });
  </script>
</body>

</html>