<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>animation-keyframes demo</title>
  
  <script charset="utf-8">
    /**
     * Adapter to use BezierEasing installed via bower.
     */
    (global => {
      if (!global.module) {
        global.module = {};
        Object.defineProperty(global.module, 'exports', {
          set: (mod) => global.BezierEasing = mod
        });
      }
    })(this);
  </script>
  <script src="../bezier-easing/src/index.js"></script>

  <script src="../webcomponentsjs/webcomponents-loader.js"></script>

  <link rel="import" href="../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../iron-demo-helpers/demo-snippet.html">
  <link rel="import" href="../paper-input/paper-input.html">
  <link rel="import" href="../paper-button/paper-button.html">
  <link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
  <link rel="import" href="../paper-listbox/paper-listbox.html">
  <link rel="import" href="../paper-item/paper-item.html">
  <link rel="import" href="../animation-keyframes/animation-keyframes.html">

  <custom-style>
    <style is="custom-style" include="demo-pages-shared-styles">
      demo-snippet {
        --demo-snippet-demo: {
          height: 0;
          padding: 0;
        }
        --demo-snippet-code: {
          max-height: 300px;
          padding: 0;
          padding-left: 5px;
        }
      }

      #wrapper {
        margin-top: 1rem;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        background-color: #f5f5f5;
      }

      #content {
        padding: 10px;
      }

      .start-invisible:not([visible]) {
        display: none;
      }

      #play {
        width: 100%;
        margin: 10px 0;
      }

      #wrapper,
      #content {
        transform-origin: top left;
        animation-delay: 400ms;
        animation-fill-mode: both;
      }

      #play:not([disabled])+#wrapper,
      #play:not([disabled])+#wrapper #content {
        animation-name: none !important;
      }

      .inputs {
        @apply --layout-horizontal;
        @apply --layout-justified;
        @apply --layout-wrap;
      }
      .inputs > * {
        min-width: 100px;
      }
    </style>
  </custom-style>
</head>

<body class="centered">
  <dom-bind>
    <template>
      <h2>&lt;animation-keyframes&gt; demo</h2>
      <p>&lt;animation-keyframes&gt; generates keyframes for performant expand/collapse animations. See more deails on this
        technique
        <a href="https://developers.google.com/web/updates/2017/03/performant-expand-and-collapse">here</a>.</p>

      <div class="inputs">
        <paper-input name="animationName" required label="Animation name" value="[[animationName]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[a-zA-Z]" minlength="1"></paper-input>
        <paper-input name="duration" type="number" required label="Duration (ms)" value="[[duration]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9]" max="10000" min="2"></paper-input>
        <paper-input name="fps" type="number" required label="FPS" value="[[fps]]" on-value-changed="validateAndUpdateValue" allowed-pattern="[0-9]"
          max="150" min="2"></paper-input>
        <paper-dropdown-menu label="Ease function" no-animations>
          <paper-listbox slot="dropdown-content" selected="[[easeCallbackIndex]]" on-selected-changed="updateEaseCallback">
            <template is="dom-repeat" items="[[easeCallbacks]]">
              <paper-item>[[item.displayValue]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="preset" no-animations>
          <paper-listbox slot="dropdown-content" selected="[[presetIndex]]" on-selected-changed="updatePreset">
            <template is="dom-repeat" items="[[presets]]">
              <paper-item>[[item.displayValue]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>
      <div class="inputs start-invisible" visible$="[[isCustomPreset]]">
        <paper-input name="fromScaleX" type="number" required label="From scale x" value="[[fromScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="toScaleX" type="number" required label="To scale x" value="[[toScaleX]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="fromScaleY" type="number" required label="From scale y" value="[[fromScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
        <paper-input name="toScaleY" type="number" required label="To scale x" value="[[toScaleY]]" on-value-changed="validateAndUpdateValue"
          allowed-pattern="[0-9\.]" max="3" min="0" step="0.01"></paper-input>
      </div>

      <animation-keyframes id="keyframes" animation-name="[[animationName]]" duration="[[duration]]" preset="[[preset]]" fps="[[fps]]"
        from-scale-x="[[fromScaleX]]" to-scale-x="[[toScaleX]]" from-scale-y="[[fromScaleY]]" to-scale-y="[[toScaleY]]" ease-callback="[[easeCallback]]"
        on-style-text-content-changed="updateMarkdown"></animation-keyframes>

      <paper-button id="play" raised on-tap="play">Play animation</paper-button>
      <div id="wrapper" class$="[[animationName]]" on-animationend="stop">
        <div id="content" contenteditable class$="[[computeInversedName(animationName)]]">
          <h3>Performant [[preset]] animation!</h3>
          <p>This content is editable! Try modifying it while the animation is playing!</p>
          <ul>
            <li>item 1</li>
            <li>item 2</li>
            <li>item 3</li>
          </ul>
        </div>
      </div>

      <h3>&lt;animation-keyframes&gt; generates this stylesheet for you.</h3>

      <p>
        Apply <b>[[animationName]]</b> class to the wrapper element, and <b>[[animationName]]Inverse</b> class to the content.
      </p>

      <i>Consider copying it and saving this as a static resource.</i>
      <p>
        <code>[[animationName]].css: <span id="count"></span></code>
      </p>

      <demo-snippet id="snippet"></demo-snippet>

    </template>
  </dom-bind>
  <script>
    const domBind = document.querySelector('dom-bind');
    const onNextRAF = callback => {
      callback.__raf && cancelAnimationFrame(callback.__raf);
      callback.__raf = requestAnimationFrame(() => {
        callback.__raf = null;
        callback();
      })
    };

    domBind.updateMarkdown = (event) => {
      const styleTextContent = keyframes.styleTextContent || '';
      snippet._markdown = styleTextContent ? '```css\n' + styleTextContent + '```' : '';
      count.textContent =
        `${keyframes.framesCount} keyframes, ${styleTextContent.split(/\n/).length - 1} lines, ${styleTextContent.length} chars.`;
    };

    domBind.updatePreset = (event) => {
      domBind.presetIndex = event.detail.value;
      domBind.preset = domBind.presets[domBind.presetIndex].value;
      domBind.isCustomPreset = domBind.preset === null;
      if (domBind.isCustomPreset) {
        domBind.fromScaleX = keyframes.fromScaleX;
        domBind.fromScaleY = keyframes.fromScaleY;
        domBind.toScaleX = keyframes.toScaleX;
        domBind.toScaleY = keyframes.toScaleY;
      }
    };
    domBind.updateEaseCallback = (event) => {
      domBind.easeCallbackIndex = event.detail.value;
      domBind.easeCallback = domBind.easeCallbacks[domBind.easeCallbackIndex].value;
    };

    domBind.computeInversedName = animationName => animationName + 'Inverse';
    domBind.play = () => onNextRAF(() => play.disabled = true);
    domBind.stop = () => setTimeout(() => play.disabled = false, 200);
    domBind.validateAndUpdateValue = (event) => {
      const input = event.target;
      if (input.validate())
        onNextRAF(() => domBind[input.name] = (input.type === 'number' ? Number(input.value) : input.value));
    };
    addEventListener('WebComponentsReady', () => {
      domBind.setProperties({
        animationName: 'myAnimation',
        duration: 200,
        fps: 60,
        presetIndex: 0,
        preset: 'vertical-expand',
        presets: [{
          displayValue: 'vertical expand',
          value: 'vertical-expand'
        }, {
          displayValue: 'vertical collapse',
          value: 'vertical-collapse'
        }, {
          displayValue: 'horizontal expand',
          value: 'horizontal-expand'
        }, {
          displayValue: 'horizontal collapse',
          value: 'horizontal-collapse'
        }, {
          displayValue: 'expand',
          value: 'expand'
        }, {
          displayValue: 'collapse',
          value: 'collapse'
        }, {
          displayValue: 'custom',
          value: null
        }],
        easeCallbackIndex: 0,
        easeCallback: keyframes.easeCallback,
        easeCallbacks: [{
          displayValue: 'default',
          value: keyframes.easeCallback
        }, {
          displayValue: 'linear',
          value: null
        }, {
          displayValue: 'ease',
          value: BezierEasing(.25, .1, .25, 1)
        }, {
          displayValue: 'ease-in',
          value: BezierEasing(.42, 0, 1, 1)
        }, {
          displayValue: 'ease-out',
          value: BezierEasing(0, 0, .58, 1)
        }, {
          displayValue: 'ease-in-out',
          value: BezierEasing(.42, 0, .58, 1)
        }]
      });
    });
  </script>
</body>

</html>